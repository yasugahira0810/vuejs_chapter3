# CHAPTER3 イベントとフォーム入力の受け取り

## *はじめに*

### *注意事項*

- *このリポジトリは[[秋葉原] 基礎から学ぶVue.js 輪読会[chapter3] &もくもく勉強会](https://weeyble-js.connpass.com/event/93446/)の発表資料として用意したリポジトリです。*
- *書籍の要約は正体、担当者の理解で書いているところは斜体で記載しています。*
- *「サンプルあり」と記載のある箇所は、サンプルを動かしながら説明します。*
- *権利関係で問題があれば、対応するのでご指摘ください。*

### *3章の構成*

*3章は13節, 14節, 15節の3節構成で、メインは14節。中身はザクっと以下の通り。*  

- *13. イベントハンドリング => DOMイベントを受け取って処理する方法を学ぶ。本節の学習内容は14節のインプットとなる。*
- *14. フォーム入力バインディング => Vue.jsの双方向データバインディングを説明する節。*
  + *双方向データバインティング = データバインディング(2章7節, 8節で説明) + イベントハンドリング(3章13節で説明)*
- *15. マウント要素外のイベントと操作 => 前節までの説明が当てはまらないケースの説明。*

-------------------

## SECTION13 イベントハンドリング

- イベントハンドラ: イベントに紐付ける処理の内容
- ハンドル: イベントハンドラを「ボタンをクリックしたとき」といったDOMイベントと紐付けること
- Vue.jsでは**v-onディレクティブ**を使用

### メソッドイベントハンドラ

- methodsオプションに定義されているメソッド名を指定。
- v-on:は@に省略可能。
- サンプルあり。

### インラインメソッドハンドラ

- ディレクティブの値にJavaScriptの式を直接記述可能。可読性を保つため、短い式での使用を推奨。
- もとのイベントオブジェクトまたはカスタムイベントの引数を$eventという変数名で使用可能。
  + *JavaScript側ではイベントオブジェクトをeventという変数で扱っている？それをHTML側に記載する際には$eventという変数名にすることが決まっているということ？*

### 使用可能なイベント

- Vue.jsはブラウザがサポートしているDOMイベントであればすベて使用可能。
  + ChromeやIE10以上では動作するがIE9では動作しないイベントなどがあるので要注意。
- 画像をふわっと表示させるサンプルあり。

### フォーム入力の取得

- フォームの入力値取得は次の14節で出てくるv-modelを使用するとシンプル。
- 入力内容の確認といったフック処理をしたい場合は、（v-bindと）v-onを使用する。
- フォームの入力値をDOMに反映していいか確認した上でDOMに反映させるサンプルあり。

### イベント修飾子

- DOMイベントの振る舞いを変更する修飾子。
- 修飾子の書き方を忘れていたらP.29で復習。

```javascript
v-bind:value.sync = "message"  
ディレクティブ:引数.修飾子 = 値
```

- イベント修飾子は書籍参照。
- 右クリックでのコンテキストメニュー表示あり/なしのサンプルとイベントフェーズの制御のサンプルあり。
- イベントフェーズの説明は[こちらのQiitaの記事](https://qiita.com/hosomichi/items/49500fea5fdf43f59c58)がわかりやすい。
- Qiitaの記事にもあるW3Cの図もわかりやすい。
![イベントフェーズ](https://www.w3.org/TR/DOM-Level-3-Events/images/eventflow.svg)
- *.self, .native, .passiveはサンプルありません。。。*

### キー修飾子

- 対応するキーが**押された**ときにのみハンドラが呼ばれる。

### システム修飾子

- 対応するキーが**押されている**ときにのみハンドラが呼ばれる。

-------------------

## SECTION14 フォーム入力バインディング

- 双方向データバインディングにはv-modelを使う。

### v-modelの使い方

- ユーザの入力と同期させたいデータをv-modelに指定。
- テキストフォームへの入力値を瞬時にDOMに反映させるサンプルあり。
- v-modelの代わりにv-bindとv-onの組み合わせでテキストフォームへの入力値を瞬時にDOMに反映させるサンプルもあり。（詳細は次の「Vue.jsの双方向データバインティング」参照）
- 日本語など入力の確定が必要な場合は確定まで更新しない。

### Vue.jsの双方向データバインディング

- **双方向データバインディングを実現するv-modelは、データバインディングを実現するv-bind（処理１）とイベントハンドリングを実現するv-onの処理（処理２）を一つにまとめて簡潔に記述する記法。**

#### データバインディングする（処理１）

- 2章7節, 8節で説明。
- *JavaScriptのデータの更新をHTMLのDOMに反映する。（JavaScript => HTML）*
- *サンプルあり。「データバインディングの例」をブラウザで開いてコンソールに「test.list[0].name='ゾンビ'」と打つと、HTMLが更新されてスライムがゾンビに変わる。*
- *担当者的には、このサンプルを動かして、v-bindはHTMLの描画時にmain.jsのデータを代入するだけというわけではなくて、JavaScriptのデータとDOM要素を紐づけているのだな、と腹落ちした。*

#### イベントハンドリング（処理２）

- 3章13節（前節）で説明。
- フォームに入力した文字をJavaScriptのデータに反映したい場合は「this.message = event.target.value」のように書いてリアクティブデータに代入する必要がある。
- *HTMLのイベントをJavaScriptのデータに反映する。（HTML => JavaScript）*
- *サンプルあり。「イベントハンドリングの例」をブラウザで開いてフォームに文字を入力するとthis.messageの内容がコンソールに出力される。コンソールにtest.messageと打ち込むとフォームに入力した文字が出力されるので、フォームの内容をJavaScriptのデータとして取得できていることがわかる。*

#### 処理１と処理２を自動化しよう！

- よく行われる処理１と処理２を自動化するのがv-modelという記法。
- v-modelは双方向データバインディング（HTML <=> JavaScript）と呼ばれるが、実際にはデータバインディング（JavaScript => HTML）とイベントハンドリング（HTML => JavaScript）を自動化させたもの。

### v-modelで受け取るデータの型

- 通常: 入力フォームの値の型はすべて文字列、複数選択できるフォームの値の型は配列。
- データバインディング: 値の型はバインドされるデータによって変わる。
- v-modelを使うときはバインディングしたデータと同期するため、valueやchecked, selectedを設定してあっても無視される。
- *次項からはバインドされるデータごとに値の型が示されている。*

### 複数行テキスト

- 書籍参照。サンプルあり。書き方に注意。

### チェックボックス

- 書籍参照。サンプルあり。
- サンプルを動かした後コンソールで「test.val」と「test.val2」と「test.val3」を叩くと型がわかりやすい。

### ラジオボタン

- 書籍参照。サンプルあり。

### セレクトボックス

- 書籍参照。サンプルあり。

### 画像ファイル

- 書籍参照。サンプルあり。

### その他の入力タイプ

- 書籍参照。サンプルあり。

### 修飾子

- 書籍参照。サンプルあり。

-------------------

## SECTION15 マウント要素外のイベントと操作

- マウントした要素内で発生するイベントはv-onでハンドルできるが、window, bodyなどのマウント要素外のイベントではv-onは使用不可。そのためwindowオブジェクトのaddEventListenerメソッドを使う。
  + マウントの説明はP.27, P.44参照。HTMLの要素とアプリケーションを紐づけること。

### スクロールイベントの取得

- スクロールに併せて表示を変化させるサンプルあり。

### スムーススクロールの実装

- スムーススクロールの実装にはwindowオブジェクトの操作が必要。
- 「Smooth Scroll」を使用するといい。サンプルあり。